# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **Dev Container Features** repository implementing the [Dev Container specification](https://containers.dev/). It creates custom dev container features published to GitHub Container Registry (GHCR). Currently contains the `tig` feature - a terminal UI for Git.

## Commands

### Testing

```bash
# Install the dev container CLI
npm install -g @devcontainers/cli

# Run autogenerated tests for a feature
devcontainer features test --skip-scenarios -f tig -i mcr.microsoft.com/devcontainers/base:ubuntu .

# Run scenario-based tests only
devcontainer features test -f tig --skip-autogenerated --skip-duplicated .

# Run full test suite
devcontainer features test
```

### Validation

Feature JSON validation happens automatically via GitHub Actions on PRs.

## Architecture

### Feature Structure

Each feature lives in `src/<feature-name>/` with:
- `devcontainer-feature.json` - Metadata, version, and options schema
- `install.sh` - Bash installation script (runs as root during container build)
- `README.md` - Auto-generated documentation (do not edit manually)

### Testing Structure

Tests live in `test/<feature-name>/`:
- `scenarios.json` - Defines test scenarios with different option combinations
- `test.sh` - Auto-generated test script
- `<scenario-name>.sh` - Scenario-specific test scripts

### Key Implementation Details

- Install scripts receive options as environment variables (e.g., `$CUSTOMPREFIX` for the custom prefix option)
- Features can declare dependencies on other features via `dependsOn` in the JSON manifest
- The `tig` feature depends on `ghcr.io/devcontainers/features/common-utils`
- **Always bump the version** in `devcontainer-feature.json` when making changes to a feature. GHCR caches by version tag, so unchanged versions may serve stale content.

### CI/CD

- `.github/workflows/test.yaml` - Runs tests on push to main and PRs
- `.github/workflows/release.yaml` - Publishes features to GHCR on main branch pushes
- `.github/workflows/validate.yml` - Validates feature JSON on PRs

### Distribution

Features are published to GHCR at `ghcr.io/kenfdev/devcontainer-feature/<feature-name>:<version>`.
